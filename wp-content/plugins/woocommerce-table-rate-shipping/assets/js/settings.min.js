jQuery(document).ready(function(e){if(void 0!=jQuery("#user_permissions.betrs_settings_section")){var t=jQuery("#user_permissions.betrs_settings_section table tbody tr");switch("everyone"==jQuery("#woocommerce_betrs_shipping_user_limitation").val()&&t.eq(1).css("display","none"),jQuery("#woocommerce_betrs_shipping_user_modification").val()){case"specific-users":t.eq(3).css("display","none");break;case"specific-roles":t.eq(4).css("display","none");break;case"admins":default:t.eq(3).css("display","none"),t.eq(4).css("display","none")}}if(jQuery("#user_permissions.betrs_settings_section").on("change","#woocommerce_betrs_shipping_user_limitation",function(t){t.preventDefault();var s=e(this).val(),r=jQuery("#user_permissions.betrs_settings_section table tbody tr");"everyone"==s?r.eq(1).css("display","none"):r.eq(1).css("display","")}),jQuery("#user_permissions.betrs_settings_section").on("change","#woocommerce_betrs_shipping_user_modification",function(t){t.preventDefault();var s=e(this).val(),r=jQuery("#user_permissions.betrs_settings_section table tbody tr");r.eq(3).css("display","none"),r.eq(4).css("display","none"),"specific-roles"==s?r.eq(3).css("display",""):"specific-users"==s&&r.eq(4).css("display","")}),void 0!=jQuery("#other.betrs_settings_section")){var s=(t=jQuery("#other.betrs_settings_section table tbody")).find(".per-class-only");"per-class"!=jQuery("#woocommerce_betrs_shipping_condition").val()&&s.each(function(e,t){jQuery(t).closest("tr").css("display","none")})}function r(e){e.hasClass("open")?e.removeClass("open"):e.addClass("open")}function i(){jQuery("");jQuery(".betrs_settings_section .single-row").each(function(e){op_number=e+1,jQuery(this).attr("data-row_id",op_number),jQuery(this).find(".shipping-headline").each(function(){jQuery(this).html(jQuery(this).html().replace(/(\d)+/,op_number))}),jQuery(this).find(".titlewrap input").each(function(){this.name=this.name.replace(/\[\d+\]/,"["+op_number+"]"),0==this.name.search("option_id")&&(this.value=op_number)}),additional_box=jQuery(this).find(".additional-settings"),additional_box.html(additional_box.html().replace(/\[\d+\]/g,"["+op_number+"]")),jQuery(this).find("table.table_rates tbody").children("tr").each(function(e){jQuery(this).find("td:not(:first-child, :last-child)").find("input,textarea,select").each(function(){this.name=this.name.replace(/\[\d+\]/,"["+op_number+"]")})})})}function n(){var e=jQuery(window).height()-180;jQuery(".be-popup-container").css("max-height",e+"px")}jQuery("#general.betrs_settings_section").on("change","#woocommerce_betrs_shipping_condition",function(t){t.preventDefault(),"per-class"==e(this).val()?s.each(function(e,t){jQuery(t).closest("tr").css("display","")}):s.each(function(e,t){jQuery(t).closest("tr").css("display","none")})}),jQuery(".betrs_settings_section").on("click","h3",function(t){t.preventDefault(),r(jQuery(this)),e(this).next(".betrs_settings_inner").slideToggle("fast")}),jQuery(".betrs_settings_section").on("click",".next-link a",function(e){e.preventDefault();var t=jQuery(this).closest(".betrs_settings_inner"),s=jQuery(this).closest(".betrs_settings_section").next(".betrs_settings_section").find(".betrs_settings_inner");r(t.parent().find("h3")),t.slideToggle("fast"),r(s.parent().find("h3")),s.slideToggle("fast")}),jQuery(".betrs_settings_section").on("change",".operand_selector",function(t){t.preventDefault();var s=e(this).val(),r=jQuery(".volumetric_number").next(".description").find("span"),i=r.html();if("multiply"==s)var n=i.replace("/","x");else n=i.replace("x","/");r.html(n)}),jQuery(".betrs_settings_section").on("click",".betrs-move-option-up",function(e){e.preventDefault();var t=jQuery(this).closest(".single-row"),s=t.prev(".single-row");return 0!==s.length&&(t.insertBefore(s),i()),!1}),jQuery(".betrs_settings_section").on("click",".betrs-move-option-down",function(e){e.preventDefault();var t=jQuery(this).closest(".single-row"),s=t.next(".single-row");return 0!==s.length&&(t.insertAfter(s),i()),!1}),jQuery(".betrs_settings_section").on("click","a.betrs_table_import",function(e){e.preventDefault();var t=jQuery(this).closest(".single-row").find(".wp-list-table.table_rates"),s=jQuery(this).closest(".single-row").attr("data-row_id"),r=t.find("tbody > tr").length;1==r&&t.find("tbody").children("tr:first").hasClass("no-items")&&r--;var i='<div id="betrs-import-table-popup" class="betrs-popup"><div class="be-popup-container add_form" id="betrs-import-table-form"><form method="post" enctype="multipart/form-data"><h3>'+betrs_data.text_importing_table+"</h3><p><span>"+betrs_data.text_importing_csv+'</span></p><input type="hidden" name="option_ID" id="option_ID" value="'+s+'" /><input type="hidden" name="row_ID" id="row_ID" value="'+r+'" /><p><input type="file" name="betrs_import_csv" id="betrs_import_csv" accept=".csv, text/csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel" /></p><p><label><input type="checkbox" name="betrs_table_delete" id="betrs_table_delete" />'+betrs_data.text_importing_del+'</label></p><p><input type="submit" name="betrs_table_import" value="'+betrs_data.text_upload+'" class="form_submit" /> <a href="#" class="cancel">'+betrs_data.text_cancel+"</a></p></form></div></div>";jQuery("body").append(i),n()}),jQuery(document).on("submit","#betrs-import-table-form",function(t){t.preventDefault();var s=jQuery(this).find("input#option_ID").val(),r=jQuery(this).find("input#row_ID").val(),i=jQuery("#BETRS-table-rates-parent").find('.single-row[data-row_id="'+s+'"]').find(".wp-list-table.table_rates tbody"),n=jQuery(this).find("input#betrs_table_delete"),o=jQuery(this).find("input#betrs_import_csv");if(o.val()){var a=o[0].files[0],p=jQuery(this);if([".csv","text/csv","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"].indexOf(a.type)>-1||/(\.csv)$/i.test(a.name)){p.block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var c=new FileReader;c.readAsText(a),c.onload=function(t){n.is(":checked")&&(i.find("tr").remove(),r=0);var o={action:"betrs_import_table",csvFile:t.target.result,optionID:s,rowID:r};e.post(ajaxurl,o,function(t){if(-1!=t.search("<tr"))i.append(t),e(document.body).trigger("wc-enhanced-select-init"),void 0!=i.find("tr.no-items")&&i.find("tr.no-items").remove(),jQuery("#betrs-import-table-popup").remove();else{var s=p.find("p span");s.text(betrs_data.text_error),s.css("color","#f44336"),p.find(".blockUI").remove()}})}}else jQuery(this).find('input[type="file"]').parent().css("border","1px solid #f44336")}else jQuery(this).find('input[type="file"]').parent().css("border","1px solid #f44336");return!1}),jQuery(".betrs_settings_section").on("click","a.betrs_table_export",function t(s){s.preventDefault();var r=[];var i=jQuery(this);var o=jQuery(this).closest(".single-row").find(".wp-list-table.table_rates tbody tr th input:checked");o.each(function(e,t){var s=jQuery(t).closest("tr").find("input, select, textarea");r.push(s.serialize())});if(0==r.length)return void alert(betrs_data.text_no_selection);var a='<div id="betrs-export-table-popup" class="betrs-popup"><div class="be-popup-container add_form"><h2>'+betrs_data.text_exporting+'</h2><p><img src="'+betrs_data.ajax_loader_url+'" alt="loading..." /></div></div>';jQuery("body").append(a);n();var p={action:"betrs_export_table",rowsSelected:r};e.post(ajaxurl,p,function(e){0==e?(jQuery("#betrs-export-table-popup").find("h2").text(betrs_data.text_error).addClass("betrs_error"),jQuery("#betrs-export-table-popup").find("h2").after("<p>"+betrs_data.text_error_server+"</p>"),jQuery("#betrs-export-table-popup").find("img").parent().remove(),setTimeout(function(){jQuery("#betrs-export-table-popup").remove()},3e3)):(i.attr("href","data:text/csv;base64,"+btoa(e)),jQuery(".betrs_settings_section").off("click","a.betrs_table_export"),i[0].click(),jQuery("#betrs-export-table-popup").remove(),jQuery(".betrs_settings_section").on("click","a.betrs_table_export",t))});return!1}),jQuery(window).on("resize",function(){n()}),jQuery(document).on("click",".be-popup-container .cancel",function(){return jQuery(".betrs-popup").remove(),!1})});